<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <title>Yujin's To-Do List</title>
</head>
<body>
  <div class="container">
    <div class="section-container">
      <section class="search-section">
        <div class="header">
          <div style="min-width: 1200px;display: flex;width: 100%; justify-content: center;align-items: center;">
            <img src="./20240706_163109.png"/>
            <img src="https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png" alt="Google Logo" class="google-logo">
            <img src="./20240706_163137.png"/>
          </div>
          <div style="display: flex;width: 100%; justify-content: center;min-width: 1200px;align-items: center;">
            <img src="./20240706_163155.png"/>
            <input type="text" class="google-search" placeholder="Google 검색">
            <img src="./20240706_163206.png"/>
          </div>
        </div>
      </section>
      <section class="main-section">
        <div class="main">
          <div class="todo-header">
            <h2>Today's goals</h2>
            <button class="add-btn">&#43;</button>
          </div>
          <div class="todo-list-wrapper">
            <!-- <div class="todo-item">
              <button class="delete-btn" style="display: none;">Delete</button>
            </div> -->
          </div>
        </div>
      </section>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const mainContainer = document.querySelector('.main');
      const listWrapperContainer = document.querySelector('.todo-list-wrapper');

      function loadTasks() {
        const tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        tasks.forEach(task => {
          addTodoItem(task.text, task.completed);
        });
      }

      function addTodoItem(text = '', completed = false) {
        let currentList = document.querySelector('.main > .todo-list-wrapper > .todo-list:last-child');
        if (!currentList || currentList.children.length >= 5) {
          currentList = document.createElement('div');
          currentList.classList.add('todo-list');
          listWrapperContainer.appendChild(currentList);
        }

        const newItem = document.createElement('div');
        newItem.classList.add('todo-item');
        newItem.innerHTML = `
          <button class="clover-btn ${completed ? 'active' : ''}" style="color: ${completed ? 'rgb(124, 247, 113)' : 'lightgray'}"><i class="fa-solid fa-clover"></i></button>
          <input type="text" class="todo-input" placeholder="Add a new task" maxlength="50" value="${text}">
          <button class="more-btn">&#8942;</button>
          <button class="delete-btn" style="display: none;">Delete</button>
        `;
        currentList.appendChild(newItem);

        // Ensure the input and buttons are correctly initialized
        const input = newItem.querySelector('.todo-input');
        const cloverButton = newItem.querySelector('.clover-btn');
        const moreButton = newItem.querySelector('.more-btn');
        const deleteButton = newItem.querySelector('.delete-btn');

        input.focus();

        input.addEventListener('focusout', function() {
          if (input.value.trim() === '') {
            newItem.remove(); // 빈 입력 필드인 경우 DOM에서 제거
          } else {
            saveTask(input, cloverButton.classList.contains('active'));
          }
        });

        cloverButton.addEventListener('click', function() {
          const isActive = cloverButton.classList.contains('active');
          cloverButton.classList.toggle('active');
          cloverButton.style.animation = 'none'; // 애니메이션 초기화
          setTimeout(() => {
            if (isActive) {
              // 완료 취소 애니메이션
              cloverButton.style.animation = 'fill-down 2s ease forwards, splash-reverse 2s 2s forwards';
            } else {
              // 완료 애니메이션
              cloverButton.style.animation = 'fill-up 2s ease forwards, splash 2s 2s forwards';
            }
          }, 10);
          saveTask(input, !isActive);
        });

        moreButton.addEventListener('click', function() {
          deleteButton.style.display = deleteButton.style.display === 'none' ? 'block' : 'none';
        });

        deleteButton.addEventListener('click', function() {
          const item = newItem;
          const list = item.parentNode;
          const allLists = Array.from(document.querySelectorAll('.todo-list'));
          let currentIndex = allLists.indexOf(list);

          // 항목 삭제
          item.remove();
          removeTask(input.value);

          // 뒤에 있는 모든 리스트에서 첫 번째 항목을 현재 리스트로 이동
          for (let i = currentIndex; i < allLists.length - 1; i++) {
            const nextList = allLists[i + 1];
            if (nextList && nextList.children.length > 0) {
              const firstItem = nextList.children[0];
              allLists[i].appendChild(firstItem);
            }

            // 만약 리스트가 비어있다면 제거
            if (nextList.children.length === 0) {
              nextList.remove();
            }
          }

          // 현재 리스트가 비어있는지 다시 확인하고 제거
          if (list.children.length === 0) {
            list.remove();
          }
        });
      }

      const addButton = document.querySelector('.add-btn');
      addButton.addEventListener('click', function() {
        addTodoItem();
      });

      function saveTask(input, completed) {
        const tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        const taskIndex = tasks.findIndex(t => t.text === input.value);
        if (taskIndex > -1) {
          tasks[taskIndex] = { text: input.value, completed };
        } else {
          tasks.push({ text: input.value, completed });
        }
        localStorage.setItem('tasks', JSON.stringify(tasks));
      }

      function removeTask(text) {
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        tasks = tasks.filter(task => task.text !== text);
        localStorage.setItem('tasks', JSON.stringify(tasks));
      }

      loadTasks(); // Load tasks on page load
    });

    document.querySelector('.google-search').addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        const query = this.value.trim();
        if (query) {
          window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
        }
      }
    });
  </script>
</body>
</html>